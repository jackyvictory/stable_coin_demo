<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Status Update Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 6px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            margin-bottom: 15px;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #6c757d;
            transition: all 0.3s ease;
        }
        .status-dot.connecting {
            background-color: #ffc107;
            animation: pulse 1.5s infinite;
        }
        .status-dot.waiting {
            background-color: #17a2b8;
            animation: pulse 2s infinite;
        }
        .status-dot.confirmed {
            background-color: #28a745;
        }
        .status-dot.failed {
            background-color: #dc3545;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .test-button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: white;
        }
        .test-button.connect { background-color: #28a745; }
        .test-button.disconnect { background-color: #dc3545; }
        .test-button.error { background-color: #ffc107; color: #000; }
        .test-button.success { background-color: #17a2b8; }
        .log-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .success-preview {
            background-color: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .summary-label {
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }
        .summary-value {
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2>🔌 WebSocket Status Update Test</h2>
        <p>测试二维码页面中 WebSocket 连接断开时的状态显示修改</p>
        
        <!-- 模拟状态指示器 -->
        <div class="status-indicator" id="status-indicator">
            <div class="status-dot" id="status-dot"></div>
            <span class="status-text" id="status-text">Connecting to blockchain</span>
        </div>
        
        <!-- 测试按钮 -->
        <div>
            <button class="test-button connect" onclick="testConnecting()">测试连接中</button>
            <button class="test-button success" onclick="testConnected()">测试已连接</button>
            <button class="test-button disconnect" onclick="testDisconnected()">测试断开连接</button>
            <button class="test-button error" onclick="testError()">测试错误状态</button>
        </div>
        
        <!-- 日志显示 -->
        <h4>状态变化日志:</h4>
        <div class="log-container" id="log-container">
            <div style="color: #666; font-style: italic;">点击按钮测试状态变化...</div>
        </div>
    </div>

    <div class="test-container">
        <h2>🎉 支付成功页面预览</h2>
        <p>测试去掉 Detection Method / Detection Time，增加独立的 Blockchain Info 部分</p>
        
        <div class="success-preview">
            <h3 style="margin-top: 0; color: #28a745;">Payment Details</h3>
            <div class="summary-details">
                <div class="summary-item">
                    <span class="summary-label">Item:</span>
                    <span class="summary-value">Food Donation (Rice)</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Amount:</span>
                    <span class="summary-value">10.00</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Payment Method:</span>
                    <span class="summary-value">USDT</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Network:</span>
                    <span class="summary-value">BSC</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">PayID:</span>
                    <span class="summary-value">PAY-20241223-001</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Transaction Time:</span>
                    <span class="summary-value" id="mock-timestamp">Dec 23, 2024, 10:30:45 AM</span>
                </div>
            </div>
        </div>

        <!-- Blockchain Info Section Preview -->
        <div class="blockchain-info-preview" style="margin-top: 20px; padding: 20px; border-radius: 8px; background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%); border: 2px solid #b3d9ff;">
            <h3 style="margin: 0 0 15px 0; color: #0056b3; font-size: 18px; font-weight: bold; display: flex; align-items: center; gap: 8px;">
                🔗 Blockchain Info
            </h3>
            <div class="blockchain-details" style="display: flex; flex-direction: column; gap: 12px;">
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">Transaction Hash:</span>
                    <span id="mock-tx-hash" style="font-size: 13px; color: #007bff; font-family: 'Courier New', monospace; font-weight: 500;">0x1a2b3c4d5e...f9g8h7</span>
                </div>
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">Block Number:</span>
                    <span id="mock-block-number" style="font-size: 13px; color: #333; font-family: 'Courier New', monospace;">#12345678</span>
                </div>
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">From Address:</span>
                    <span id="mock-from-addr" style="font-size: 13px; color: #28a745; font-family: 'Courier New', monospace; font-weight: 500;">0x9f8e7d6c...5b4a39</span>
                </div>
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">To Address:</span>
                    <span id="mock-to-addr" style="font-size: 13px; color: #28a745; font-family: 'Courier New', monospace; font-weight: 500;">0xe27577B0...cb78a04</span>
                </div>
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">Block Timestamp:</span>
                    <span id="mock-block-timestamp" style="font-size: 13px; color: #333; font-family: 'Courier New', monospace;">Dec 23, 2024, 10:30:42 AM</span>
                </div>
                <div class="blockchain-item" style="display: flex; justify-content: space-between; align-items: flex-start; padding: 10px 12px; background-color: rgba(255, 255, 255, 0.7); border-radius: 6px; border: 1px solid #cce7ff;">
                    <span style="font-size: 13px; color: #0056b3; font-weight: bold; min-width: 120px;">Amount & Currency:</span>
                    <span id="mock-amount" style="font-size: 13px; color: #dc3545; font-family: 'Courier New', monospace; font-weight: bold;">10.00 USDT</span>
                </div>
            </div>
        </div>
        
        <!-- 区块链信息测试按钮 -->
        <div style="margin-top: 15px;">
            <button class="test-button success" onclick="updateBlockchainInfo('sample1')">模拟区块链信息 1</button>
            <button class="test-button success" onclick="updateBlockchainInfo('sample2')">模拟区块链信息 2</button>
            <button class="test-button error" onclick="updateBlockchainInfo('empty')">无区块链信息</button>
        </div>
    </div>

    <div class="test-container">
        <h2>📋 修改总结</h2>
        <ul>
            <li>✅ 二维码页面：WebSocket 连接断开时显示 "Disconnected from blockchain" 而不是 "Monitoring stopped"</li>
            <li>✅ 支付成功页面：去掉了 Detection Method / Detection Time 部分</li>
            <li>✅ 支付成功页面：添加了独立的 "Blockchain Info" 部分，包含详细的区块链信息</li>
            <li>✅ Blockchain Info 包含：Transaction Hash, Block Number, From/To Address, Block Timestamp, Amount & Currency</li>
            <li>✅ 所有调试代码都放在 demo/debug 目录中</li>
            <li>✅ 没有产生过程的 .md 总结文档</li>
        </ul>
    </div>

    <script>
        // 模拟 updatePaymentStatus 函数
        function updatePaymentStatus(status, message) {
            const statusIndicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const statusDot = document.getElementById('status-dot');
            
            if (statusText) {
                statusText.textContent = message;
            }
            
            if (statusDot) {
                // 清除所有状态类
                statusDot.classList.remove('confirmed', 'failed', 'connecting', 'waiting', 'error');
                
                switch (status) {
                    case 'connecting':
                        statusDot.classList.add('connecting');
                        break;
                    case 'waiting':
                    case 'monitoring':
                        statusDot.classList.add('waiting');
                        break;
                    case 'confirmed':
                        statusDot.classList.add('confirmed');
                        break;
                    case 'failed':
                    case 'expired':
                    case 'error':
                    case 'stopped':
                        statusDot.classList.add('failed');
                        break;
                    default:
                        break;
                }
            }
            
            // 记录日志
            logStatusChange(status, message);
        }
        
        // 记录状态变化
        function logStatusChange(status, message) {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: #007bff; font-weight: bold;">${status}</span>: ${message}`;
            
            // 如果是第一条日志，清除提示文本
            if (logContainer.children.length === 1 && logContainer.children[0].style.fontStyle === 'italic') {
                logContainer.innerHTML = '';
            }
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // 测试函数
        function testConnecting() {
            updatePaymentStatus('connecting', 'Connecting to blockchain');
        }
        
        function testConnected() {
            updatePaymentStatus('waiting', 'Monitoring for payment');
        }
        
        function testDisconnected() {
            // 使用修改后的文本
            updatePaymentStatus('error', 'Disconnected from blockchain');
        }
        
        function testError() {
            updatePaymentStatus('failed', 'Connection failed');
        }
        
        // 更新区块链信息
        function updateBlockchainInfo(sampleType) {
            const now = new Date();
            const timestamp = now.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // 更新交易时间戳
            const timestampElement = document.getElementById('mock-timestamp');
            if (timestampElement) {
                timestampElement.textContent = timestamp;
            }
            
            let sampleData;
            
            switch (sampleType) {
                case 'sample1':
                    sampleData = {
                        txHash: '0x1a2b3c4d5e...f9g8h7',
                        blockNumber: '#12345678',
                        fromAddr: '0x9f8e7d6c...5b4a39',
                        toAddr: '0xe27577B0...cb78a04',
                        blockTimestamp: timestamp,
                        amount: '10.00 USDT'
                    };
                    break;
                case 'sample2':
                    sampleData = {
                        txHash: '0x7f6e5d4c3b...a9b8c7',
                        blockNumber: '#12345679',
                        fromAddr: '0x3c2b1a09...8f7e6d',
                        toAddr: '0xe27577B0...cb78a04',
                        blockTimestamp: timestamp,
                        amount: '25.50 USDC'
                    };
                    break;
                case 'empty':
                default:
                    sampleData = {
                        txHash: 'N/A',
                        blockNumber: 'N/A',
                        fromAddr: 'N/A',
                        toAddr: 'N/A',
                        blockTimestamp: 'N/A',
                        amount: 'N/A'
                    };
                    break;
            }
            
            // 更新所有区块链信息字段
            const elements = {
                'mock-tx-hash': sampleData.txHash,
                'mock-block-number': sampleData.blockNumber,
                'mock-from-addr': sampleData.fromAddr,
                'mock-to-addr': sampleData.toAddr,
                'mock-block-timestamp': sampleData.blockTimestamp,
                'mock-amount': sampleData.amount
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });
        }
        
        // 页面加载时显示初始状态
        window.addEventListener('load', function() {
            logStatusChange('info', 'Test page loaded - ready for status testing');
        });
    </script>
</body>
</html>