<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Syntax Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        .log { background: #f5f5f5; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>QR Code Syntax Test</h1>
    
    <div id="status" class="status">Loading...</div>
    
    <div class="log" id="log"></div>

    <script src="../config.js"></script>
    <script src="../lib/web3.min.js"></script>
    <script src="../js/blockchain-ws.js"></script>
    <script src="../js/payment-handler-ws.js"></script>

    <script>
        let logElement;
        let statusElement;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            
            if (logElement) {
                logElement.textContent += logEntry;
                logElement.scrollTop = logElement.scrollHeight;
            }
            
            console.log(message);
        }

        function setStatus(message, isError = false) {
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `status ${isError ? 'error' : 'success'}`;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            logElement = document.getElementById('log');
            statusElement = document.getElementById('status');
            
            try {
                log('üöÄ Testing QR Code JavaScript syntax...');
                
                // Test if qrcode-ws.js loaded without syntax errors
                setStatus('‚úÖ JavaScript syntax is valid', false);
                log('‚úÖ qrcode-ws.js loaded successfully');
                
                // Test basic functions
                if (typeof loadPaymentData === 'function') {
                    log('‚úÖ loadPaymentData function found');
                } else {
                    log('‚ùå loadPaymentData function not found');
                }
                
                if (typeof startWebSocketMonitoring === 'function') {
                    log('‚úÖ startWebSocketMonitoring function found');
                } else {
                    log('‚ùå startWebSocketMonitoring function not found');
                }
                
                if (typeof toggleDebugPanel === 'function') {
                    log('‚úÖ toggleDebugPanel function found');
                } else {
                    log('‚ùå toggleDebugPanel function not found');
                }
                
                // Test blockchain manager
                setTimeout(() => {
                    if (typeof window.blockchainManager !== 'undefined') {
                        log('‚úÖ Blockchain manager found');
                        log(`   Type: ${typeof window.blockchainManager}`);
                        log(`   isConnected: ${window.blockchainManager.isConnected}`);
                    } else {
                        log('‚ö†Ô∏è Blockchain manager not found yet');
                    }
                }, 2000);
                
            } catch (error) {
                setStatus('‚ùå JavaScript syntax error detected', true);
                log(`‚ùå Error: ${error.message}`);
                log(`   Stack: ${error.stack}`);
            }
        });

        // Listen for blockchain ready event
        window.addEventListener('blockchainReady', (event) => {
            log('üéâ Received blockchainReady event');
            log(`   WebSocket optimized: ${event.detail.optimized}`);
        });

        // Test error handling
        window.addEventListener('error', (event) => {
            log(`‚ùå JavaScript Error: ${event.message}`);
            log(`   File: ${event.filename}:${event.lineno}:${event.colno}`);
            setStatus('‚ùå Runtime error detected', true);
        });
    </script>

    <!-- Try to load qrcode-ws.js -->
    <script src="../js/qrcode-ws.js"></script>
</body>
</html>