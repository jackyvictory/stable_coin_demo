<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Test Tool - Stable Coin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-title {
            color: #2328da;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .test-button {
            background: #2328da;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .test-button:hover {
            background: #1a1f9a;
        }

        .success-button {
            background: #28a745;
        }

        .success-button:hover {
            background: #218838;
        }

        .warning-button {
            background: #ffc107;
            color: #212529;
        }

        .warning-button:hover {
            background: #e0a800;
        }

        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }

        .step-list {
            list-style: none;
            padding: 0;
        }

        .step-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .step-list li:before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1 class="test-title">ğŸ§ª Payment Flow Test Tool</h1>

        <div class="info-box">
            <strong>Description:</strong> This tool helps you test payment flow navigation without requiring a web3 wallet.
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test Steps</h3>
            <ul class="step-list">
                <li>Create mock payment data</li>
                <li>Navigate to QR code page</li>
                <li>Simulate payment success</li>
                <li>Verify navigation to success page</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸš€ Quick Test</h3>
            <p>Click the button below to start the complete payment flow test:</p>
            <button class="test-button success-button" onclick="startFullTest()">
                ğŸ¯ Start Complete Test Flow
            </button>
            <button class="test-button" onclick="createMockPayment()">
                ğŸ“ Create Mock Payment Data
            </button>
            <button class="test-button" onclick="goToQRCode()">
                ğŸ“± Go to QR Code Page
            </button>
            <button class="test-button success-button" onclick="simulatePaymentSuccess()">
                âœ… Simulate Payment Success
            </button>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ Step-by-Step Test</h3>
            <p>If you want to test each step individually:</p>
            <button class="test-button" onclick="testProductSelection()">
                ğŸ›’ Test Product Selection Page
            </button>
            <button class="test-button" onclick="testPaymentSelection()">
                ğŸ’³ Test Payment Selection Page
            </button>
            <button class="test-button warning-button" onclick="testQRCodePage()">
                ğŸ“± Test QR Code Page
            </button>
            <button class="test-button success-button" onclick="testSuccessPage()">
                ğŸ‰ Test Success Page
            </button>
        </div>

        <div class="test-section">
            <h3>ğŸ› ï¸ Debug Tools</h3>
            <button class="test-button" onclick="showCurrentPaymentData()">
                ğŸ“Š View Current Payment Data
            </button>
            <button class="test-button" onclick="clearPaymentData()">
                ğŸ—‘ï¸ Clear Payment Data
            </button>
            <button class="test-button" onclick="showStorageInfo()">
                ğŸ’¾ View Storage Info
            </button>
        </div>

        <div id="output"
            style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px; font-family: monospace; font-size: 12px; display: none;">
        </div>
    </div>

    <script>
        // è¾“å‡ºæ—¥å¿—å‡½æ•°
        function log(message) {
            const output = document.getElementById('output');
            output.style.display = 'block';
            output.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        // åˆ›å»ºæ¨¡æ‹Ÿæ”¯ä»˜æ•°æ®
        function createMockPayment() {
            const mockPaymentData = {
                paymentId: 'test_' + Date.now(),
                product: 'rice',
                productName: 'Food Donation (Rice)',
                price: 5.00,
                currency: 'USD',
                status: 'waiting',
                timestamp: Date.now(),
                expiresAt: Date.now() + (30 * 60 * 1000), // 30åˆ†é’Ÿåè¿‡æœŸ
                selectedPayment: {
                    symbol: 'USDT',
                    name: 'Tether USD'
                },
                selectedNetwork: {
                    symbol: 'BSC',
                    name: 'BNB Smart Chain'
                },
                receiverAddress: '0xe27577B0e3920cE35f100f66430de0108cb78a04'
            };

            // ä¿å­˜åˆ° sessionStorage
            sessionStorage.setItem('paymentData', JSON.stringify(mockPaymentData));

            log('âœ… Mock payment data created: ' + mockPaymentData.paymentId);
            log('ğŸ’° Amount: $' + mockPaymentData.price);
            log('ğŸª™ Payment method: ' + mockPaymentData.selectedPayment.symbol);
            log('ğŸŒ Network: ' + mockPaymentData.selectedNetwork.symbol);

            return mockPaymentData;
        }

        // è·³è½¬åˆ°äºŒç»´ç é¡µé¢
        function goToQRCode() {
            // ç¡®ä¿æœ‰æ”¯ä»˜æ•°æ®
            const paymentData = sessionStorage.getItem('paymentData');
            if (!paymentData) {
                log('âš ï¸ No payment data found, creating mock data...');
                createMockPayment();
            }

            log('ğŸ”„ Navigating to QR code page...');
            setTimeout(() => {
                window.location.href = 'qrcode-ws.html';
            }, 1000);
        }

        // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ
        function simulatePaymentSuccess() {
            const paymentDataStr = sessionStorage.getItem('paymentData');
            if (!paymentDataStr) {
                log('âŒ No payment data found');
                return;
            }

            const paymentData = JSON.parse(paymentDataStr);

            // æ·»åŠ éªŒè¯ç»“æœ
            paymentData.verificationResult = {
                verified: true,
                transfer: {
                    transactionHash: '0x' + Math.random().toString(16).substr(2, 64),
                    blockNumber: Math.floor(Math.random() * 1000000) + 30000000,
                    formattedValue: paymentData.price.toString()
                },
                confirmations: 3,
                amount: paymentData.price.toString()
            };

            paymentData.status = 'confirmed';
            paymentData.confirmedAt = Date.now();

            // æ›´æ–°å­˜å‚¨
            sessionStorage.setItem('paymentData', JSON.stringify(paymentData));

            log('ğŸ‰ Payment success simulated!');
            log('ğŸ“ Transaction hash: ' + paymentData.verificationResult.transfer.transactionHash);
            log('ğŸ”„ Navigating to success page...');

            setTimeout(() => {
                window.location.href = 'success-ws.html';
            }, 2000);
        }

        // å¼€å§‹å®Œæ•´æµ‹è¯•æµç¨‹
        function startFullTest() {
            log('ğŸš€ Starting complete test flow...');

            // 1. åˆ›å»ºæ¨¡æ‹Ÿæ”¯ä»˜æ•°æ®
            const paymentData = createMockPayment();

            // 2. ç­‰å¾…ä¸€ç§’åè·³è½¬åˆ°äºŒç»´ç é¡µé¢
            setTimeout(() => {
                log('ğŸ“± About to navigate to QR code page, please use debug features to test payment success...');
                log('ğŸ’¡ Tip: On the QR code page, click "âš™ï¸ Debug" button, then click "ğŸ¯ Complete Flow Test"');

                setTimeout(() => {
                    window.location.href = 'qrcode-ws.html';
                }, 2000);
            }, 1000);
        }

        // æµ‹è¯•å„ä¸ªé¡µé¢
        function testProductSelection() {
            log('ğŸ›’ Navigating to product selection page...');
            window.location.href = 'index.html';
        }

        function testPaymentSelection() {
            // ç¡®ä¿æœ‰åŸºæœ¬çš„äº§å“æ•°æ®
            if (!sessionStorage.getItem('selectedProduct')) {
                sessionStorage.setItem('selectedProduct', JSON.stringify({
                    key: 'rice',
                    name: 'Food Donation (Rice)',
                    price: 5.00
                }));
            }
            log('ğŸ’³ Navigating to payment selection page...');
            window.location.href = 'payment-ws.html';
        }

        function testQRCodePage() {
            createMockPayment();
            log('ğŸ“± Navigating to QR code page...');
            window.location.href = 'qrcode-ws.html';
        }

        function testSuccessPage() {
            createMockPayment();
            simulatePaymentSuccess();
        }

        // è°ƒè¯•å·¥å…·
        function showCurrentPaymentData() {
            const paymentData = sessionStorage.getItem('paymentData');
            if (paymentData) {
                log('ğŸ“Š Current payment data:');
                log(JSON.stringify(JSON.parse(paymentData), null, 2));
            } else {
                log('âŒ No payment data found');
            }
        }

        function clearPaymentData() {
            sessionStorage.removeItem('paymentData');
            sessionStorage.removeItem('selectedProduct');
            sessionStorage.removeItem('currentPaymentId');
            log('ğŸ—‘ï¸ Payment data cleared');
        }

        function showStorageInfo() {
            log('ğŸ’¾ SessionStorage contents:');
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                log(`${key}: ${value.substring(0, 100)}${value.length > 100 ? '...' : ''}`);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            log('ğŸ§ª Payment test tool loaded');
            log('ğŸ’¡ You can use this tool to test payment flow without a real web3 wallet');
        });
    </script>
</body>

</html>