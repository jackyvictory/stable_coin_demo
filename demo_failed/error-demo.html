<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVO Payment - Error Handler Demo</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .card h3 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #46C16D;
        }
        
        .btn-danger {
            background: #D7272B;
        }
        
        .btn-warning {
            background: #DD6B20;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .error-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .error-item {
            border-bottom: 1px solid #dee2e6;
            padding: 10px 0;
            font-size: 12px;
        }
        
        .error-item:last-child {
            border-bottom: none;
        }
        
        .error-type {
            font-weight: bold;
            color: #D7272B;
        }
        
        .error-time {
            color: #666;
            font-size: 11px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
    
    <!-- é…ç½®æ–‡ä»¶ -->
    <script src="./config.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš¨ EVO Payment Error Handler Demo</h1>
            <p>é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤ºåŠŸèƒ½æ¼”ç¤º</p>
        </div>
        
        <div class="demo-grid">
            <!-- é€šçŸ¥æµ‹è¯• -->
            <div class="card">
                <h3>ğŸ“¢ é€šçŸ¥æµ‹è¯•</h3>
                
                <div class="form-group">
                    <label for="notificationMessage">é€šçŸ¥æ¶ˆæ¯</label>
                    <input type="text" id="notificationMessage" value="This is a test notification" placeholder="è¾“å…¥é€šçŸ¥æ¶ˆæ¯">
                </div>
                
                <div class="form-group">
                    <label for="notificationType">é€šçŸ¥ç±»å‹</label>
                    <select id="notificationType">
                        <option value="info">Info</option>
                        <option value="success">Success</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
                
                <button id="showNotification" class="btn">æ˜¾ç¤ºé€šçŸ¥</button>
                <button id="showMultipleNotifications" class="btn btn-secondary">æ˜¾ç¤ºå¤šä¸ªé€šçŸ¥</button>
            </div>
            
            <!-- é”™è¯¯ç±»å‹æµ‹è¯• -->
            <div class="card">
                <h3>âš ï¸ é”™è¯¯ç±»å‹æµ‹è¯•</h3>
                
                <button onclick="testNetworkError()" class="btn btn-danger">ç½‘ç»œé”™è¯¯</button>
                <button onclick="testWalletError()" class="btn btn-danger">é’±åŒ…é”™è¯¯</button>
                <button onclick="testPaymentError()" class="btn btn-danger">æ”¯ä»˜é”™è¯¯</button>
                <button onclick="testValidationError()" class="btn btn-danger">éªŒè¯é”™è¯¯</button>
                <button onclick="testBlockchainError()" class="btn btn-danger">åŒºå—é“¾é”™è¯¯</button>
                <button onclick="testTimeoutError()" class="btn btn-danger">è¶…æ—¶é”™è¯¯</button>
                <button onclick="testSystemError()" class="btn btn-danger">ç³»ç»Ÿé”™è¯¯</button>
            </div>
            
            <!-- åŠ è½½çŠ¶æ€æµ‹è¯• -->
            <div class="card">
                <h3>â³ åŠ è½½çŠ¶æ€æµ‹è¯•</h3>
                
                <div class="form-group">
                    <label for="loadingMessage">åŠ è½½æ¶ˆæ¯</label>
                    <input type="text" id="loadingMessage" value="Processing payment..." placeholder="è¾“å…¥åŠ è½½æ¶ˆæ¯">
                </div>
                
                <button id="showLoading" class="btn btn-info">æ˜¾ç¤ºåŠ è½½</button>
                <button id="hideLoading" class="btn btn-secondary">éšè—åŠ è½½</button>
                <button id="simulateLoading" class="btn btn-warning">æ¨¡æ‹ŸåŠ è½½è¿‡ç¨‹</button>
            </div>
            
            <!-- æ¢å¤ç­–ç•¥æµ‹è¯• -->
            <div class="card">
                <h3>ğŸ”„ æ¢å¤ç­–ç•¥æµ‹è¯•</h3>
                
                <button onclick="testWalletInstallGuide()" class="btn btn-info">é’±åŒ…å®‰è£…æŒ‡å—</button>
                <button onclick="testNetworkSwitchGuide()" class="btn btn-info">ç½‘ç»œåˆ‡æ¢æŒ‡å—</button>
                <button onclick="testRetryOption()" class="btn btn-info">é‡è¯•é€‰é¡¹</button>
                <button onclick="testPaymentExpired()" class="btn btn-warning">æ”¯ä»˜è¿‡æœŸå¤„ç†</button>
                <button onclick="testWalletDisconnected()" class="btn btn-warning">é’±åŒ…æ–­å¼€å¤„ç†</button>
            </div>
            
            <!-- é”™è¯¯ç»Ÿè®¡ -->
            <div class="card">
                <h3>ğŸ“Š é”™è¯¯ç»Ÿè®¡</h3>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalErrors">0</div>
                        <div class="stat-label">æ€»é”™è¯¯æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="networkErrors">0</div>
                        <div class="stat-label">ç½‘ç»œé”™è¯¯</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="paymentErrors">0</div>
                        <div class="stat-label">æ”¯ä»˜é”™è¯¯</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="systemErrors">0</div>
                        <div class="stat-label">ç³»ç»Ÿé”™è¯¯</div>
                    </div>
                </div>
                
                <button id="refreshStats" class="btn">åˆ·æ–°ç»Ÿè®¡</button>
                <button id="clearStats" class="btn btn-secondary">æ¸…é™¤ç»Ÿè®¡</button>
                <button id="exportLog" class="btn btn-info">å¯¼å‡ºæ—¥å¿—</button>
            </div>
            
            <!-- æœ€è¿‘é”™è¯¯ -->
            <div class="card">
                <h3>ğŸ“‹ æœ€è¿‘é”™è¯¯</h3>
                
                <div id="recentErrors" class="error-list">
                    <p style="text-align: center; color: #666;">æš‚æ— é”™è¯¯è®°å½•</p>
                </div>
                
                <button id="refreshErrors" class="btn">åˆ·æ–°åˆ—è¡¨</button>
            </div>
            
            <!-- ç½‘ç»œçŠ¶æ€ -->
            <div class="card">
                <h3>ğŸŒ ç½‘ç»œçŠ¶æ€</h3>
                
                <div id="networkStatus" style="margin-bottom: 20px;">
                    <p><strong>çŠ¶æ€:</strong> <span id="connectionStatus">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>ç±»å‹:</strong> <span id="connectionType">æœªçŸ¥</span></p>
                    <p><strong>é€Ÿåº¦:</strong> <span id="connectionSpeed">æœªçŸ¥</span></p>
                </div>
                
                <button id="checkNetworkStatus" class="btn">æ£€æŸ¥ç½‘ç»œçŠ¶æ€</button>
                <button onclick="simulateOffline()" class="btn btn-warning">æ¨¡æ‹Ÿç¦»çº¿</button>
                <button onclick="simulateOnline()" class="btn btn-success">æ¨¡æ‹Ÿåœ¨çº¿</button>
            </div>
            
            <!-- è‡ªå®šä¹‰é”™è¯¯æµ‹è¯• -->
            <div class="card">
                <h3>ğŸ› ï¸ è‡ªå®šä¹‰é”™è¯¯æµ‹è¯•</h3>
                
                <div class="form-group">
                    <label for="customErrorMessage">é”™è¯¯æ¶ˆæ¯</label>
                    <textarea id="customErrorMessage" rows="3" placeholder="è¾“å…¥è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯">Custom error message for testing purposes</textarea>
                </div>
                
                <div class="form-group">
                    <label for="customErrorType">é”™è¯¯ç±»å‹</label>
                    <select id="customErrorType">
                        <option value="network_error">Network Error</option>
                        <option value="payment_error">Payment Error</option>
                        <option value="wallet_error">Wallet Error</option>
                        <option value="validation_error">Validation Error</option>
                        <option value="blockchain_error">Blockchain Error</option>
                        <option value="timeout_error">Timeout Error</option>
                        <option value="system_error">System Error</option>
                    </select>
                </div>
                
                <button id="triggerCustomError" class="btn btn-danger">è§¦å‘è‡ªå®šä¹‰é”™è¯¯</button>
            </div>
        </div>
    </div>
    
    <!-- ErrorHandler -->
    <script src="./js/error-handler.js"></script>
    
    <!-- æ¼”ç¤ºè„šæœ¬ -->
    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Error Handler Demo åˆå§‹åŒ–');
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // åˆå§‹åŒ–ç½‘ç»œçŠ¶æ€
            updateNetworkStatus();
            
            // åˆ·æ–°ç»Ÿè®¡
            refreshStats();
            
            console.log('âœ… Demo åˆå§‹åŒ–å®Œæˆ');
        });
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // é€šçŸ¥æµ‹è¯•
            document.getElementById('showNotification').addEventListener('click', showTestNotification);
            document.getElementById('showMultipleNotifications').addEventListener('click', showMultipleNotifications);
            
            // åŠ è½½çŠ¶æ€æµ‹è¯•
            document.getElementById('showLoading').addEventListener('click', showTestLoading);
            document.getElementById('hideLoading').addEventListener('click', hideTestLoading);
            document.getElementById('simulateLoading').addEventListener('click', simulateLoadingProcess);
            
            // ç»Ÿè®¡ç›¸å…³
            document.getElementById('refreshStats').addEventListener('click', refreshStats);
            document.getElementById('clearStats').addEventListener('click', clearStats);
            document.getElementById('exportLog').addEventListener('click', exportErrorLog);
            document.getElementById('refreshErrors').addEventListener('click', refreshRecentErrors);
            
            // ç½‘ç»œçŠ¶æ€
            document.getElementById('checkNetworkStatus').addEventListener('click', updateNetworkStatus);
            
            // è‡ªå®šä¹‰é”™è¯¯
            document.getElementById('triggerCustomError').addEventListener('click', triggerCustomError);
        }
        
        // æ˜¾ç¤ºæµ‹è¯•é€šçŸ¥
        function showTestNotification() {
            const message = document.getElementById('notificationMessage').value;
            const type = document.getElementById('notificationType').value;
            
            window.ErrorHandler.showNotification(message, type);
        }
        
        // æ˜¾ç¤ºå¤šä¸ªé€šçŸ¥
        function showMultipleNotifications() {
            const types = ['info', 'success', 'warning', 'error'];
            const messages = [
                'This is an info notification',
                'Operation completed successfully!',
                'Please check your input',
                'An error occurred during processing'
            ];
            
            types.forEach((type, index) => {
                setTimeout(() => {
                    window.ErrorHandler.showNotification(messages[index], type);
                }, index * 500);
            });
        }
        
        // é”™è¯¯ç±»å‹æµ‹è¯•å‡½æ•°
        function testNetworkError() {
            window.ErrorHandler.handleError(
                new Error('Network connection failed'),
                window.ErrorHandler.errorTypes.NETWORK_ERROR
            );
        }
        
        function testWalletError() {
            window.ErrorHandler.handleError(
                new Error('MetaMask not found. Please install MetaMask.'),
                window.ErrorHandler.errorTypes.WALLET_ERROR
            );
        }
        
        function testPaymentError() {
            window.ErrorHandler.handleError(
                new Error('Payment processing failed due to insufficient funds'),
                window.ErrorHandler.errorTypes.PAYMENT_ERROR
            );
        }
        
        function testValidationError() {
            window.ErrorHandler.handleError(
                new Error('Invalid amount: amount is too small'),
                window.ErrorHandler.errorTypes.VALIDATION_ERROR
            );
        }
        
        function testBlockchainError() {
            window.ErrorHandler.handleError(
                new Error('Transaction failed on blockchain'),
                window.ErrorHandler.errorTypes.BLOCKCHAIN_ERROR
            );
        }
        
        function testTimeoutError() {
            window.ErrorHandler.handleError(
                new Error('Request timeout after 30 seconds'),
                window.ErrorHandler.errorTypes.TIMEOUT_ERROR
            );
        }
        
        function testSystemError() {
            window.ErrorHandler.handleError(
                new Error('Unexpected system error occurred'),
                window.ErrorHandler.errorTypes.SYSTEM_ERROR
            );
        }
        
        // åŠ è½½çŠ¶æ€æµ‹è¯•
        function showTestLoading() {
            const message = document.getElementById('loadingMessage').value;
            window.ErrorHandler.showLoading(message);
        }
        
        function hideTestLoading() {
            window.ErrorHandler.hideLoading();
        }
        
        function simulateLoadingProcess() {
            const steps = [
                'Connecting to wallet...',
                'Validating transaction...',
                'Broadcasting to blockchain...',
                'Waiting for confirmation...',
                'Transaction completed!'
            ];
            
            let currentStep = 0;
            
            function nextStep() {
                if (currentStep < steps.length) {
                    window.ErrorHandler.showLoading(steps[currentStep]);
                    currentStep++;
                    setTimeout(nextStep, 2000);
                } else {
                    window.ErrorHandler.hideLoading();
                    window.ErrorHandler.showNotification('Process completed successfully!', 'success');
                }
            }
            
            nextStep();
        }
        
        // æ¢å¤ç­–ç•¥æµ‹è¯•
        function testWalletInstallGuide() {
            window.ErrorHandler.showWalletInstallGuide();
        }
        
        function testNetworkSwitchGuide() {
            window.ErrorHandler.showNetworkSwitchGuide();
        }
        
        function testRetryOption() {
            window.ErrorHandler.showRetryOption('Operation failed. Would you like to retry?');
        }
        
        function testPaymentExpired() {
            window.ErrorHandler.handlePaymentExpired();
        }
        
        function testWalletDisconnected() {
            window.ErrorHandler.handleWalletDisconnected();
        }
        
        // åˆ·æ–°ç»Ÿè®¡
        function refreshStats() {
            const stats = window.ErrorHandler.getErrorStats();
            
            document.getElementById('totalErrors').textContent = stats.total;
            document.getElementById('networkErrors').textContent = stats.byType.network_error || 0;
            document.getElementById('paymentErrors').textContent = stats.byType.payment_error || 0;
            document.getElementById('systemErrors').textContent = stats.byType.system_error || 0;
            
            refreshRecentErrors();
        }
        
        // æ¸…é™¤ç»Ÿè®¡
        function clearStats() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰é”™è¯¯ç»Ÿè®¡å—ï¼Ÿ')) {
                window.ErrorHandler.clearErrorStats();
                refreshStats();
            }
        }
        
        // å¯¼å‡ºé”™è¯¯æ—¥å¿—
        function exportErrorLog() {
            const logData = window.ErrorHandler.exportErrorLog();
            const blob = new Blob([logData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `error-log-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            window.ErrorHandler.showNotification('Error log exported successfully', 'success');
        }
        
        // åˆ·æ–°æœ€è¿‘é”™è¯¯
        function refreshRecentErrors() {
            const stats = window.ErrorHandler.getErrorStats();
            const container = document.getElementById('recentErrors');
            
            if (stats.recent.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— é”™è¯¯è®°å½•</p>';
                return;
            }
            
            container.innerHTML = stats.recent.map(error => `
                <div class="error-item">
                    <div class="error-type">${error.type}</div>
                    <div>${error.message}</div>
                    <div class="error-time">${error.timestamp.toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        // æ›´æ–°ç½‘ç»œçŠ¶æ€
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            
            document.getElementById('connectionStatus').textContent = isOnline ? 'åœ¨çº¿' : 'ç¦»çº¿';
            document.getElementById('connectionType').textContent = connection ? connection.effectiveType : 'æœªçŸ¥';
            document.getElementById('connectionSpeed').textContent = connection ? 
                `${connection.downlink} Mbps` : 'æœªçŸ¥';
            
            window.ErrorHandler.showNetworkStatus();
        }
        
        // æ¨¡æ‹Ÿç¦»çº¿
        function simulateOffline() {
            // è§¦å‘ç¦»çº¿äº‹ä»¶
            window.dispatchEvent(new Event('offline'));
        }
        
        // æ¨¡æ‹Ÿåœ¨çº¿
        function simulateOnline() {
            // è§¦å‘åœ¨çº¿äº‹ä»¶
            window.dispatchEvent(new Event('online'));
        }
        
        // è§¦å‘è‡ªå®šä¹‰é”™è¯¯
        function triggerCustomError() {
            const message = document.getElementById('customErrorMessage').value;
            const type = document.getElementById('customErrorType').value;
            
            window.ErrorHandler.handleError(new Error(message), type);
        }
        
        // ç›‘å¬ç³»ç»Ÿé”™è¯¯äº‹ä»¶
        window.addEventListener('systemError', function(event) {
            console.log('ç³»ç»Ÿé”™è¯¯äº‹ä»¶:', event.detail);
            refreshStats();
        });
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            console.log('ğŸš¨ Error Handler Demo å·²åŠ è½½');
            window.ErrorHandler.showNotification('Error Handler Demo loaded successfully!', 'success');
        });
    </script>
</body>
</html>