<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVO Payment - Error Handler Demo</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 25px;
        }
        
        .card h3 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-success {
            background: #46C16D;
        }
        
        .btn-danger {
            background: #D7272B;
        }
        
        .btn-warning {
            background: #DD6B20;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .error-list {
            max-height: 300px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .error-item {
            border-bottom: 1px solid #dee2e6;
            padding: 10px 0;
            font-size: 12px;
        }
        
        .error-item:last-child {
            border-bottom: none;
        }
        
        .error-type {
            font-weight: bold;
            color: #D7272B;
        }
        
        .error-time {
            color: #666;
            font-size: 11px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
    
    <!-- 配置文件 -->
    <script src="./config.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚨 EVO Payment Error Handler Demo</h1>
            <p>错误处理和用户提示功能演示</p>
        </div>
        
        <div class="demo-grid">
            <!-- 通知测试 -->
            <div class="card">
                <h3>📢 通知测试</h3>
                
                <div class="form-group">
                    <label for="notificationMessage">通知消息</label>
                    <input type="text" id="notificationMessage" value="This is a test notification" placeholder="输入通知消息">
                </div>
                
                <div class="form-group">
                    <label for="notificationType">通知类型</label>
                    <select id="notificationType">
                        <option value="info">Info</option>
                        <option value="success">Success</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
                
                <button id="showNotification" class="btn">显示通知</button>
                <button id="showMultipleNotifications" class="btn btn-secondary">显示多个通知</button>
            </div>
            
            <!-- 错误类型测试 -->
            <div class="card">
                <h3>⚠️ 错误类型测试</h3>
                
                <button onclick="testNetworkError()" class="btn btn-danger">网络错误</button>
                <button onclick="testWalletError()" class="btn btn-danger">钱包错误</button>
                <button onclick="testPaymentError()" class="btn btn-danger">支付错误</button>
                <button onclick="testValidationError()" class="btn btn-danger">验证错误</button>
                <button onclick="testBlockchainError()" class="btn btn-danger">区块链错误</button>
                <button onclick="testTimeoutError()" class="btn btn-danger">超时错误</button>
                <button onclick="testSystemError()" class="btn btn-danger">系统错误</button>
            </div>
            
            <!-- 加载状态测试 -->
            <div class="card">
                <h3>⏳ 加载状态测试</h3>
                
                <div class="form-group">
                    <label for="loadingMessage">加载消息</label>
                    <input type="text" id="loadingMessage" value="Processing payment..." placeholder="输入加载消息">
                </div>
                
                <button id="showLoading" class="btn btn-info">显示加载</button>
                <button id="hideLoading" class="btn btn-secondary">隐藏加载</button>
                <button id="simulateLoading" class="btn btn-warning">模拟加载过程</button>
            </div>
            
            <!-- 恢复策略测试 -->
            <div class="card">
                <h3>🔄 恢复策略测试</h3>
                
                <button onclick="testWalletInstallGuide()" class="btn btn-info">钱包安装指南</button>
                <button onclick="testNetworkSwitchGuide()" class="btn btn-info">网络切换指南</button>
                <button onclick="testRetryOption()" class="btn btn-info">重试选项</button>
                <button onclick="testPaymentExpired()" class="btn btn-warning">支付过期处理</button>
                <button onclick="testWalletDisconnected()" class="btn btn-warning">钱包断开处理</button>
            </div>
            
            <!-- 错误统计 -->
            <div class="card">
                <h3>📊 错误统计</h3>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalErrors">0</div>
                        <div class="stat-label">总错误数</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="networkErrors">0</div>
                        <div class="stat-label">网络错误</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="paymentErrors">0</div>
                        <div class="stat-label">支付错误</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="systemErrors">0</div>
                        <div class="stat-label">系统错误</div>
                    </div>
                </div>
                
                <button id="refreshStats" class="btn">刷新统计</button>
                <button id="clearStats" class="btn btn-secondary">清除统计</button>
                <button id="exportLog" class="btn btn-info">导出日志</button>
            </div>
            
            <!-- 最近错误 -->
            <div class="card">
                <h3>📋 最近错误</h3>
                
                <div id="recentErrors" class="error-list">
                    <p style="text-align: center; color: #666;">暂无错误记录</p>
                </div>
                
                <button id="refreshErrors" class="btn">刷新列表</button>
            </div>
            
            <!-- 网络状态 -->
            <div class="card">
                <h3>🌐 网络状态</h3>
                
                <div id="networkStatus" style="margin-bottom: 20px;">
                    <p><strong>状态:</strong> <span id="connectionStatus">检查中...</span></p>
                    <p><strong>类型:</strong> <span id="connectionType">未知</span></p>
                    <p><strong>速度:</strong> <span id="connectionSpeed">未知</span></p>
                </div>
                
                <button id="checkNetworkStatus" class="btn">检查网络状态</button>
                <button onclick="simulateOffline()" class="btn btn-warning">模拟离线</button>
                <button onclick="simulateOnline()" class="btn btn-success">模拟在线</button>
            </div>
            
            <!-- 自定义错误测试 -->
            <div class="card">
                <h3>🛠️ 自定义错误测试</h3>
                
                <div class="form-group">
                    <label for="customErrorMessage">错误消息</label>
                    <textarea id="customErrorMessage" rows="3" placeholder="输入自定义错误消息">Custom error message for testing purposes</textarea>
                </div>
                
                <div class="form-group">
                    <label for="customErrorType">错误类型</label>
                    <select id="customErrorType">
                        <option value="network_error">Network Error</option>
                        <option value="payment_error">Payment Error</option>
                        <option value="wallet_error">Wallet Error</option>
                        <option value="validation_error">Validation Error</option>
                        <option value="blockchain_error">Blockchain Error</option>
                        <option value="timeout_error">Timeout Error</option>
                        <option value="system_error">System Error</option>
                    </select>
                </div>
                
                <button id="triggerCustomError" class="btn btn-danger">触发自定义错误</button>
            </div>
        </div>
    </div>
    
    <!-- ErrorHandler -->
    <script src="./js/error-handler.js"></script>
    
    <!-- 演示脚本 -->
    <script>
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Error Handler Demo 初始化');
            
            // 绑定事件
            bindEvents();
            
            // 初始化网络状态
            updateNetworkStatus();
            
            // 刷新统计
            refreshStats();
            
            console.log('✅ Demo 初始化完成');
        });
        
        // 绑定事件
        function bindEvents() {
            // 通知测试
            document.getElementById('showNotification').addEventListener('click', showTestNotification);
            document.getElementById('showMultipleNotifications').addEventListener('click', showMultipleNotifications);
            
            // 加载状态测试
            document.getElementById('showLoading').addEventListener('click', showTestLoading);
            document.getElementById('hideLoading').addEventListener('click', hideTestLoading);
            document.getElementById('simulateLoading').addEventListener('click', simulateLoadingProcess);
            
            // 统计相关
            document.getElementById('refreshStats').addEventListener('click', refreshStats);
            document.getElementById('clearStats').addEventListener('click', clearStats);
            document.getElementById('exportLog').addEventListener('click', exportErrorLog);
            document.getElementById('refreshErrors').addEventListener('click', refreshRecentErrors);
            
            // 网络状态
            document.getElementById('checkNetworkStatus').addEventListener('click', updateNetworkStatus);
            
            // 自定义错误
            document.getElementById('triggerCustomError').addEventListener('click', triggerCustomError);
        }
        
        // 显示测试通知
        function showTestNotification() {
            const message = document.getElementById('notificationMessage').value;
            const type = document.getElementById('notificationType').value;
            
            window.ErrorHandler.showNotification(message, type);
        }
        
        // 显示多个通知
        function showMultipleNotifications() {
            const types = ['info', 'success', 'warning', 'error'];
            const messages = [
                'This is an info notification',
                'Operation completed successfully!',
                'Please check your input',
                'An error occurred during processing'
            ];
            
            types.forEach((type, index) => {
                setTimeout(() => {
                    window.ErrorHandler.showNotification(messages[index], type);
                }, index * 500);
            });
        }
        
        // 错误类型测试函数
        function testNetworkError() {
            window.ErrorHandler.handleError(
                new Error('Network connection failed'),
                window.ErrorHandler.errorTypes.NETWORK_ERROR
            );
        }
        
        function testWalletError() {
            window.ErrorHandler.handleError(
                new Error('MetaMask not found. Please install MetaMask.'),
                window.ErrorHandler.errorTypes.WALLET_ERROR
            );
        }
        
        function testPaymentError() {
            window.ErrorHandler.handleError(
                new Error('Payment processing failed due to insufficient funds'),
                window.ErrorHandler.errorTypes.PAYMENT_ERROR
            );
        }
        
        function testValidationError() {
            window.ErrorHandler.handleError(
                new Error('Invalid amount: amount is too small'),
                window.ErrorHandler.errorTypes.VALIDATION_ERROR
            );
        }
        
        function testBlockchainError() {
            window.ErrorHandler.handleError(
                new Error('Transaction failed on blockchain'),
                window.ErrorHandler.errorTypes.BLOCKCHAIN_ERROR
            );
        }
        
        function testTimeoutError() {
            window.ErrorHandler.handleError(
                new Error('Request timeout after 30 seconds'),
                window.ErrorHandler.errorTypes.TIMEOUT_ERROR
            );
        }
        
        function testSystemError() {
            window.ErrorHandler.handleError(
                new Error('Unexpected system error occurred'),
                window.ErrorHandler.errorTypes.SYSTEM_ERROR
            );
        }
        
        // 加载状态测试
        function showTestLoading() {
            const message = document.getElementById('loadingMessage').value;
            window.ErrorHandler.showLoading(message);
        }
        
        function hideTestLoading() {
            window.ErrorHandler.hideLoading();
        }
        
        function simulateLoadingProcess() {
            const steps = [
                'Connecting to wallet...',
                'Validating transaction...',
                'Broadcasting to blockchain...',
                'Waiting for confirmation...',
                'Transaction completed!'
            ];
            
            let currentStep = 0;
            
            function nextStep() {
                if (currentStep < steps.length) {
                    window.ErrorHandler.showLoading(steps[currentStep]);
                    currentStep++;
                    setTimeout(nextStep, 2000);
                } else {
                    window.ErrorHandler.hideLoading();
                    window.ErrorHandler.showNotification('Process completed successfully!', 'success');
                }
            }
            
            nextStep();
        }
        
        // 恢复策略测试
        function testWalletInstallGuide() {
            window.ErrorHandler.showWalletInstallGuide();
        }
        
        function testNetworkSwitchGuide() {
            window.ErrorHandler.showNetworkSwitchGuide();
        }
        
        function testRetryOption() {
            window.ErrorHandler.showRetryOption('Operation failed. Would you like to retry?');
        }
        
        function testPaymentExpired() {
            window.ErrorHandler.handlePaymentExpired();
        }
        
        function testWalletDisconnected() {
            window.ErrorHandler.handleWalletDisconnected();
        }
        
        // 刷新统计
        function refreshStats() {
            const stats = window.ErrorHandler.getErrorStats();
            
            document.getElementById('totalErrors').textContent = stats.total;
            document.getElementById('networkErrors').textContent = stats.byType.network_error || 0;
            document.getElementById('paymentErrors').textContent = stats.byType.payment_error || 0;
            document.getElementById('systemErrors').textContent = stats.byType.system_error || 0;
            
            refreshRecentErrors();
        }
        
        // 清除统计
        function clearStats() {
            if (confirm('确定要清除所有错误统计吗？')) {
                window.ErrorHandler.clearErrorStats();
                refreshStats();
            }
        }
        
        // 导出错误日志
        function exportErrorLog() {
            const logData = window.ErrorHandler.exportErrorLog();
            const blob = new Blob([logData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `error-log-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            window.ErrorHandler.showNotification('Error log exported successfully', 'success');
        }
        
        // 刷新最近错误
        function refreshRecentErrors() {
            const stats = window.ErrorHandler.getErrorStats();
            const container = document.getElementById('recentErrors');
            
            if (stats.recent.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">暂无错误记录</p>';
                return;
            }
            
            container.innerHTML = stats.recent.map(error => `
                <div class="error-item">
                    <div class="error-type">${error.type}</div>
                    <div>${error.message}</div>
                    <div class="error-time">${error.timestamp.toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        // 更新网络状态
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            
            document.getElementById('connectionStatus').textContent = isOnline ? '在线' : '离线';
            document.getElementById('connectionType').textContent = connection ? connection.effectiveType : '未知';
            document.getElementById('connectionSpeed').textContent = connection ? 
                `${connection.downlink} Mbps` : '未知';
            
            window.ErrorHandler.showNetworkStatus();
        }
        
        // 模拟离线
        function simulateOffline() {
            // 触发离线事件
            window.dispatchEvent(new Event('offline'));
        }
        
        // 模拟在线
        function simulateOnline() {
            // 触发在线事件
            window.dispatchEvent(new Event('online'));
        }
        
        // 触发自定义错误
        function triggerCustomError() {
            const message = document.getElementById('customErrorMessage').value;
            const type = document.getElementById('customErrorType').value;
            
            window.ErrorHandler.handleError(new Error(message), type);
        }
        
        // 监听系统错误事件
        window.addEventListener('systemError', function(event) {
            console.log('系统错误事件:', event.detail);
            refreshStats();
        });
        
        // 页面加载完成
        window.addEventListener('load', function() {
            console.log('🚨 Error Handler Demo 已加载');
            window.ErrorHandler.showNotification('Error Handler Demo loaded successfully!', 'success');
        });
    </script>
</body>
</html>